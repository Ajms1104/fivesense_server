<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>FIVE-SENSE</title>
    <link rel="stylesheet" href="/css/main.css" />
    <link rel="stylesheet" href="/css/profile.css" />
    <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
    <script>
        // ë²„ì „ í™•ì¸
        document.addEventListener('DOMContentLoaded', () => {
            console.log('LightweightCharts version:', LightweightCharts.version);
        });

        // ì•„ë˜ì²˜ëŸ¼ ì¢…ëª© í´ë¦­ ì‹œì—ë§Œ ìƒì„±
        function renderTopVolumeTable() {
            // ...
            tr.addEventListener('click', () => {
                document.querySelector('.top-volume-section').style.display = 'none';
                document.querySelector('.chart').style.display = 'block';
                document.getElementById('stockSelector').value = stock.stk_cd;
                if (!window.stockChart) {
                    window.stockChart = new StockChart();
                }
                window.stockChart.stockCode = stock.stk_cd;
                window.stockChart.fetchChartData();
                addBackButton();
            });
            // ...
        }
    </script>
</head>

<body>
    <div class="profile-container">
        <div class="user-info" th:if="${user != null}" th:text="${user.accountid + 'ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤'}"></div>
        <div class="user-info" th:unless="${user != null}">ê²ŒìŠ¤íŠ¸ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤</div>
        <div class="profile-btn" id="profileBtn">
            <span>ğŸ‘¤</span>
        </div>
        <div class="dropdown-menu" id="profileMenu">
            <a th:if="${user != null}" href="/logout">ë¡œê·¸ì•„ì›ƒ</a>
            <a th:unless="${user != null}" href="/login">ë¡œê·¸ì¸</a>
            <a th:unless="${user != null}" href="/register">íšŒì›ê°€ì…</a>
            <a th:if="${user != null}" href="/mypage">ë‚´ ì •ë³´</a>
        </div>
    </div>
    
    <section class="sidebar">
      <span class="name">FIVE-SENSE</span>
        <button>ê°œì¸ì„¤ì •</button>
        <button>ì¦ê²¨ì°¾ê¸°</button>
        <button>í¬í† í´ë¦¬ì˜¤</button>

        <nav>
            <p style="color: black;">ë¼ì´ë¸ŒëŸ¬ë¦¬</p>
            <div class="history"></div>
            <div id="news-list" style="margin-top:20px;"></div>
            <div id="news-pagination" style="margin-top:8px; display:flex; gap:4px;"></div>
        </nav>
    </section>

    <section class="main">
      <div class="main-left">
        <div class="top-volume-section">
          <h3>ë‹¹ì¼ ê±°ë˜ëŸ‰ ìƒìœ„ ì¢…ëª©</h3>
          <table id="topVolumeTable" class="top-volume-table">
            <thead>
              <tr>
                <th>ìˆœìœ„</th>
                <th>ì¢…ëª©ëª…</th>
                <th>í˜„ì¬ê°€</th>
                <th>ë“±ë½ë¥ </th>
                <th>ì¦ê²¨ì°¾ê¸°</th>
              </tr>
            </thead>
            <tbody>
              <!-- JSë¡œ ë™ì  ìƒì„± -->
            </tbody>
          </table>
          <div id="topVolumePagination"></div>
        </div>
        <div class="chart" style="display: none;">
           <div class="chart-header">
              <p class="chart-title">ì£¼ì‹ ì°¨íŠ¸</p>
              <div class="chart-controls">
                  <div class="chart-type-btn" data-type="minute">ë¶„</div>
                  <select id="minuteSelector" class="stock-select" style="display: none;">
                      <option value="1">1ë¶„</option>
                      <option value="3">3ë¶„</option>
                      <option value="5">5ë¶„</option>
                      <option value="10">10ë¶„</option>
                      <option value="15">15ë¶„</option>
                      <option value="30">30ë¶„</option>
                      <option value="45">45ë¶„</option>
                      <option value="60">60ë¶„</option>
                  </select>
                  <div class="chart-type-btn active" data-type="daily">ì¼</div>
                  <div class="chart-type-btn" data-type="weekly">ì£¼</div>
                  <div class="chart-type-btn" data-type="monthly">ì›”</div>
                  <div class="chart-type-btn" data-type="yearly">ë…„</div>
                  <select id="stockSelector" class="stock-select">
                      <option value="005930">ì‚¼ì„±ì „ì</option>
                      <option value="000660">SKí•˜ì´ë‹‰ìŠ¤</option>
                      <option value="035720">ì¹´ì¹´ì˜¤</option>
                      <option value="323410">ì¹´ì¹´ì˜¤ë±…í¬</option>
                      <option value="207940">ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤</option>
                      <option value="035420">NAVER</option>
                      <option value="051910">LGí™”í•™</option>
                      <option value="005380">í˜„ëŒ€ìë™ì°¨</option>
                  </select>
              </div>
           </div>
           <div class="chart-wrapper">
              <div class="chart-container"></div>
           </div>
        </div>
      </div>
      <div class="main-right">
        <div class="chat-section">
          <div class="chat-history"></div>
          <div class="bottom-section">
              <div class="input-container">
                  <input placeholder="AI ì…ë ¥ì¹¸" />
                  <div id="submit"> â¢ </div>
              </div>
          </div>
          <p class="info">
              ì£¼ì‹ íˆ¬ìì‹œ ì›ê¸ˆ ì†ì‹¤ì— ëŒ€í•œ ì±…ì„ì€ íˆ¬ìì ë³¸ì¸ì—ê²Œ ìˆìœ¼ë©° 
              FIVE-SENSEëŠ” ì±…ì„ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.
          </p>
        </div>
      </div>
    </section>

    <script src="/js/profile.js"></script>
    <script src="/js/stockChart.js"></script>
    <script src="/js/chat.js"></script>
    <div id="news-modal" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:9999; align-items:center; justify-content:center;">
      <div style="background:#fff; padding:30px 20px; border-radius:8px; min-width:300px; max-width:90vw; max-height:80vh; overflow:auto; position:relative;">
        <span id="news-modal-close" style="position:absolute; right:10px; top:10px; cursor:pointer; font-size:20px;">âœ–</span>
        <div id="news-modal-content"></div>
      </div>
    </div>
    <script>
    // ë‰´ìŠ¤ 4ê°œì”© 10í˜ì´ì§€ë¡œ ë¶ˆëŸ¬ì˜¤ê¸° ë° ë°”ë¡œ ìƒˆ ì°½ìœ¼ë¡œ ë§í¬ ì—´ê¸°
    let newsCurrentPage = 1;
    const newsPageSize = 4;
    const newsTotalPages = 10;

    async function loadNewsList(page = 1) {
      newsCurrentPage = page;
      const newsListDiv = document.getElementById('news-list');
      newsListDiv.innerHTML = '<b>ìµœì‹  ë‰´ìŠ¤</b><ul id="news-ul" style="padding-left:18px; margin:8px 0 0 0;"></ul>';
      try {
        const res = await fetch(`/api/stock/news?page=${page}`);
        const newsArr = await res.json();
        const ul = document.getElementById('news-ul');
        ul.innerHTML = '';
        newsArr.forEach(news => {
          const li = document.createElement('li');
          li.textContent = news.title;
          li.style.cursor = 'pointer';
          li.style.marginBottom = '6px';
          li.onclick = () => window.open(news.link, '_blank');
          ul.appendChild(li);
        });
        renderNewsPagination();
      } catch(e) {
        newsListDiv.innerHTML += '<div style="color:red; font-size:13px;">ë‰´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
      }
    }
    function renderNewsPagination() {
      const pagDiv = document.getElementById('news-pagination');
      pagDiv.innerHTML = '';
      for (let i = 1; i <= newsTotalPages; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.style.padding = '2px 8px';
        btn.style.margin = '0 2px';
        btn.style.borderRadius = '4px';
        btn.style.border = '1px solid #bbb';
        btn.style.background = (i === newsCurrentPage) ? '#007bff' : '#fff';
        btn.style.color = (i === newsCurrentPage) ? '#fff' : '#222';
        btn.onclick = () => loadNewsList(i);
        pagDiv.appendChild(btn);
      }
    }
    document.addEventListener('DOMContentLoaded', () => loadNewsList(1));
    </script>
</body>
</html> 